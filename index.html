<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>A Biased Caf√© Guide for St Pete</title>
<meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no">
<link href="https://api.mapbox.com/mapbox-gl-js/v3.5.1/mapbox-gl.css" rel="stylesheet">
<script src="https://api.mapbox.com/mapbox-gl-js/v3.5.1/mapbox-gl.js"></script>
<script src="https://d3js.org/d3.v7.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Kalnia Glaze">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Cute Font">


<style>
body { margin: 0; padding: 0; }
#map { position: absolute; top: 0; bottom: 0; width: 100%; }
</style>
</head>
<body>
    
<style>
    #map {
        position: fixed;
        width: 50%;
    }
    #features {
        width: 50%;
        margin-left: 50%;
        font-family: sans-serif;
        overflow-y: scroll;
        background-color: #fafafa;
    }
    
    section {
        height: 100vh;
        padding: 50px 50px;
        line-height: 25px;
        border-bottom: 1px solid #ddd;
        font-size: 13px;
    }

    section#intro {
        padding-top: 20px;
        padding-right: 50px;
        padding-bottom: 0px;
        padding-left: 50px;
        background-color: #feebe7;
    }

    section#stpete {
        padding-top: 100px;
        padding-right: 120px;
        padding-bottom: 0px;
        opacity: 1;
        background-color: #efe8d7;
    }

    section.active {
        opacity: 1;
    }
    section:last-child {
        border-bottom: none;
        margin-bottom: 200px;
    }

    .mapboxgl-popup {
        max-width: 400px;
        font:
            12px/20px 'Helvetica Neue',
            Arial,
            Helvetica,
            sans-serif;
    }
</style>

<style>
    section#intro h1 {
        font-family: Kalnia Glaze;
        font-size: 100px;
        line-height: 110px;
        font-weight: 500;
    }

    section#intro h2 {
        font-family: Cute Font;
        font-size: 45px;
        color:rgb(253, 136, 136);
        -webkit-text-stroke: 0.1px black;
        line-height: 1;
    }

    section#intro p {
        font-family: Cute Font;
        font-size: 30px;
        color:rgba(0, 0, 0, 0.459);
        line-height: 1;
    }

    section#stpete p {
        font-family: Cute Font;
        font-size: 30px;
        color:rgba(0, 0, 0, 0.459);
        line-height: 1;
    }


</style>


<div id="map"></div>

<div id="features">
    <section id="intro" class="active">
        <h1>Working from Caf√©'s'‚òïÔ∏è</h1>
        <h2>A Biased Guide for St. Petersburg, FL üå¥ </h2>
        <p>
            Where can I spend the least üí∞ to get a whole-day free pass 
            for sitting there with my dear laptop?
        </p>
    </section>
    <section id="stpete" >
        <p>
            I moved to St. Petersburg about a month ago. A quick browse reveals numerous caf√©s within walking distance, especially along Central Avenue in the heart of the Grand Central District. 
        </p>
        <p>
            St. Pete is a quite small city where you can get almost anywhere within 15 minutes by bus, so it's no surprise that downtown has become a welcoming hub for coffee businesses. But I am still pleasantly surprised by the abundance of coffee shops, besides its stunningly funky life style that seems everyone adopts here. 
        </p>
        <p>
            Given my pretty flexiable working mode, I do not have to go to the newsroom every day, so just like everyone else in the city, I got a chance to check out different coffee places in town and became a semi-weekly(?) digital nomad (to some extentü§†).
        </p>
        <p>
            So I centered on the downtown coordinates of St Pete with a 5000-meter radius and used the Google Places API to capture all??? the cafes within this range, aiming to provide a supeeeer biased cafe reviews for those who also ain't working from offices but looking for a place to work from and get a pure black coffee!
        </p>
    </section>
    <section id="metrics" >
        <p>
            There are several metrics that I used to review if it is a good "workafe" 

            <br>
            
            what an awkward term...
        </p>
           </section>
    <section id="Paradeco Coffee Roasters">
        <h3>13 Caulfield Gardens</h3>
        <p>
            Holmes deduces that the murderer placed West atop a stopped train at
            Caulfield Gardens. The train traveled to Aldgate Station before
            West's body finally toppled off. Backtracking to the criminal's
            apartment, Holmes finds a series of classified ads from
            <em>The Daily Telegraph</em> stashed away. All are under the name
            Pierrot: "Monday night after nine. Two taps. Only ourselves. Do not
            be so suspicious. Payment in hard cash when goods delivered."
        </p>
    </section>
    <section id="Blush Tea and Coffee St Pete">
        <h3>Charing Cross Hotel</h3>
        <p>
            Walter writes to Oberstein and convinces him to meet in the smoking
            room of the Charing Cross Hotel where he promises additional plans
            for the submarine in exchange for money. The plan works and Holmes
            and Watson catch both criminals.
        </p>
        <small id="citation">
            Adapted from
            <a href="http://www.gutenberg.org/files/2346/2346-h/2346-h.htm">Project Gutenberg</a>
        </small>
    </section>
    <section id="Foxtail Coffee Co." >
        <h3>221b Baker St.</h3>
        <p>
            November 1895. London is shrouded in fog and Sherlock Holmes and
            Watson pass time restlessly awaiting a new case. "The London
            criminal is certainly a dull fellow," Sherlock bemoans. "There have
            been numerous petty thefts," Watson offers in response. Just then a
            telegram arrives from Sherlock's brother Mycroft with a mysterious
            case.
        </p>
    </section>
    <section id="The Sourdough Co">
        <h3>Aldgate Station</h3>
        <p>
            Arthur Cadogan West was found dead, head crushed in on train tracks
            at Aldgate Station at 6AM Tuesday morning. West worked at Woolwich
            Arsenal on the Bruce-Partington submarine, a secret military
            project. Plans for the submarine had been stolen and seven of the
            ten missing papers were found in West's possession. Mycroft implores
            Sherlock to take the case and recover the three missing papers.
        </p>
    </section>
    <section id="Bandit Coffee Co.">
        <h3>London Bridge</h3>
        <p>
            Holmes and Watson's investigations take them across London. Sherlock
            deduces that West was murdered elsewhere, then moved to Aldgate
            Station to create the illusion that he was crushed on the tracks by
            a train. On their way to Woolwich Sherlock dispatches a telegram to
            Mycroft at London Bridge: "Send list of all foreign spies known to
            be in England, with full address."
        </p>
    </section>
    <section id="Kahwa Coffee">
        <h3>Woolwich Arsenal</h3>
        <p>
            While investigating at Woolwich Arsenal Sherlock learns that West
            did not have the three keys&mdash;door, office, and
            safe&mdash;necessary to steal the papers. The train station clerk
            mentions seeing an agitated West boarding the 8:15 train to London
            Bridge. Sherlock suspects West of following someone who had access
            to the Woolwich chief's keyring with all three keys.
        </p>
    </section>
    <section id="Central Diner (formerly Central Coffee Shoppe)">
        <h3>Gloucester Road</h3>
        <p>
            Mycroft responds to Sherlock's telegram and mentions several spies.
            Hugo Oberstein of 13 Caulfield Gardens catches Sherlock's eye. He
            heads to the nearby Gloucester Road station to investigate and
            learns that the windows of Caulfield Gardens open over rail tracks
            where trains stop frequently.
        </p>
    </section>
    <section id="Intermezzo Coffee & Cocktails">
        <h3>The Daily Telegraph</h3>
        <p>
            Holmes and Watson head to The Daily Telegraph and place an ad to
            draw out the criminal. It reads: "To-night. Same hour. Same place.
            Two taps. Most vitally important. Your own safety at stake.
            Pierrot." The trap works and Holmes catches the criminal: Colonel
            Valentine Walter, the brother of Woolwich Arsenal's chief. He
            confesses to working for Hugo Oberstein to obtain the submarine
            plans in order to pay off his debts.
        </p>
    </section>
    <section id="Flatbread & Butter">
        <h3>Charing Cross Hotel</h3>
        <p>
            Walter writes to Oberstein and convinces him to meet in the smoking
            room of the Charing Cross Hotel where he promises additional plans
            for the submarine in exchange for money. The plan works and Holmes
            and Watson catch both criminals.
        </p>
        <small id="citation">
            Adapted from
            <a href="http://www.gutenberg.org/files/2346/2346-h/2346-h.htm">Project Gutenberg</a>
        </small>
    </section>
    <section id="Uptown Eats">
        <h3>Charing Cross Hotel</h3>
        <p>
            Walter writes to Oberstein and convinces him to meet in the smoking
            room of the Charing Cross Hotel where he promises additional plans
            for the submarine in exchange for money. The plan works and Holmes
            and Watson catch both criminals.
        </p>
        <small id="citation">
            Adapted from
            <a href="http://www.gutenberg.org/files/2346/2346-h/2346-h.htm">Project Gutenberg</a>
        </small>
    </section>
    <section id="Raining Berries St. Pete">
        <h3>Charing Cross Hotel</h3>
        <p>
            Walter writes to Oberstein and convinces him to meet in the smoking
            room of the Charing Cross Hotel where he promises additional plans
            for the submarine in exchange for money. The plan works and Holmes
            and Watson catch both criminals.
        </p>
        <small id="citation">
            Adapted from
            <a href="http://www.gutenberg.org/files/2346/2346-h/2346-h.htm">Project Gutenberg</a>
        </small>
    </section>
    <section id="Grassroots Kava House">
        <h3>Charing Cross Hotel</h3>
        <p>
            Walter writes to Oberstein and convinces him to meet in the smoking
            room of the Charing Cross Hotel where he promises additional plans
            for the submarine in exchange for money. The plan works and Holmes
            and Watson catch both criminals.
        </p>
        <small id="citation">
            Adapted from
            <a href="http://www.gutenberg.org/files/2346/2346-h/2346-h.htm">Project Gutenberg</a>
        </small>
    </section>
    <section id="La Deja Vu Cafe - Bistro - Restaurant">
        <h3>Charing Cross Hotel</h3>
        <p>
            Walter writes to Oberstein and convinces him to meet in the smoking
            room of the Charing Cross Hotel where he promises additional plans
            for the submarine in exchange for money. The plan works and Holmes
            and Watson catch both criminals.
        </p>
        <small id="citation">
            Adapted from
            <a href="http://www.gutenberg.org/files/2346/2346-h/2346-h.htm">Project Gutenberg</a>
        </small>
    </section>
    <section id="Cafe Galat">
        <h3>Charing Cross Hotel</h3>
        <p>
            Walter writes to Oberstein and convinces him to meet in the smoking
            room of the Charing Cross Hotel where he promises additional plans
            for the submarine in exchange for money. The plan works and Holmes
            and Watson catch both criminals.
        </p>
        <small id="citation">
            Adapted from
            <a href="http://www.gutenberg.org/files/2346/2346-h/2346-h.htm">Project Gutenberg</a>
        </small>
    </section>
    <section id="Crislip Caf√©">
        <h3>Charing Cross Hotel</h3>
        <p>
            Walter writes to Oberstein and convinces him to meet in the smoking
            room of the Charing Cross Hotel where he promises additional plans
            for the submarine in exchange for money. The plan works and Holmes
            and Watson catch both criminals.
        </p>
        <small id="citation">
            Adapted from
            <a href="http://www.gutenberg.org/files/2346/2346-h/2346-h.htm">Project Gutenberg</a>
        </small>
    </section>
</div>

<script>
	mapboxgl.accessToken = 'pk.eyJ1IjoiZXNldmUiLCJhIjoiY2w1Mnl6a2ZxMGhldzNkb2Nhd2gzN3YwdyJ9.KzMPd6T2OYfAU7URHv2-WA';
    const map = new mapboxgl.Map({
        container: 'map',
        // Choose from Mapbox's core styles, or make your own style with Mapbox Studio
        style: 'mapbox://styles/eseve/clys515v8001v01p92qdi51e1',
        center: [-122.1430,37.4419], //[-82.655, 27.78]
        zoom: 12,//12.6,
        bearing: 0, //face true north
        pitch: 0//58
    });

    // Function to convert CSV to GeoJSON
    function csvToGeoJSON(csvData) {
        const features = csvData.map(row => ({
            'type': 'Feature',
            'properties': {
                'description': row.description // Assuming 'description' is a column in your CSV
            },
            'geometry': {
                'type': 'Point',
                'coordinates': [parseFloat(row.longitude), parseFloat(row.latitude)] // Assuming 'longitude' and 'latitude' are columns in your CSV
            }
        }));
        return {
            'type': 'FeatureCollection',
            'features': features
        };
    }

    // Load CSV file and initialize the map
    Papa.parse('file.csv', {
    download: true,
    header: true,
    complete: function(results) {
        const geojsonData = csvToGeoJSON(results.data);

        map.on('load', () => {
            map.addSource('places', {
                'type': 'geojson',
                'data': geojsonData
            });

            // Add a layer showing the places.
            map.addLayer({
                'id': 'places',
                'type': 'circle',
                'source': 'places',
                'paint': {
                    'circle-color': '#4264fb',
                    'circle-radius': 6,
                    'circle-stroke-width': 2,
                    'circle-stroke-color': '#ffffff'
                }
            });

            // Create a popup, but don't add it to the map yet.
            const popup = new mapboxgl.Popup({
                closeButton: false,
                closeOnClick: false
            });

            map.on('mouseenter', 'places', (e) => {
                // Change the cursor style as a UI indicator.
                map.getCanvas().style.cursor = 'pointer';

                // Copy coordinates array.
                const coordinates = e.features[0].geometry.coordinates.slice();
                const description = e.features[0].properties.description;

                // Ensure that if the map is zoomed out such that multiple
                // copies of the feature are visible, the popup appears
                // over the copy being pointed to.
                if (['mercator', 'equirectangular'].includes(map.getProjection().name)) {
                    while (Math.abs(e.lngLat.lng - coordinates[0]) > 180) {
                        coordinates[0] += e.lngLat.lng > coordinates[0] ? 360 : -360;
                    }
                }

                // Populate the popup and set its coordinates
                // based on the feature found.
                popup.setLngLat(coordinates).setHTML(description).addTo(map);
            });

            map.on('mouseleave', 'places', () => {
                map.getCanvas().style.cursor = '';
                popup.remove();
            });
        });
    }
});


    let activeChapterName = '';
    let chapters = {};

    // Load and parse the CSV file
    d3.csv('stpete_all_cafe_coords.csv').then(function(data) {
        // Convert the CSV data into the chapters object
        data.forEach(d => {
            chapters[d.name] = {
                bearing: +d.bearing,
                center: [+d.center_lng, +d.center_lat],
                zoom: +d.zoom,
                pitch: +d.pitch,
                speed: d.speed ? +d.speed : 1, // Default speed to 1 if undefined
                duration: d.duration ? +d.duration : 6000 // Default duration if undefined
            };

            if (d.active === 'true') {
                activeChapterName = d.name;
            }
        });

        console.log('Chapters:', chapters); // Debugging: Check parsed data
        console.log('Initial Active Chapter:', activeChapterName); // Debugging: Check initial active chapter

        // Fly to the initial active chapter
        setActiveChapter(activeChapterName);

        // Add scroll event listener after data is loaded
        window.onscroll = () => {
            for (const chapterName in chapters) {
                if (isElementOnScreen(chapterName)) {
                    console.log('Element on screen:', chapterName); // Debugging: Check which element is on screen
                    setActiveChapter(chapterName);
                    break;
                }
            }
        };
    });

    function setActiveChapter(chapterName) {
        if (chapterName === activeChapterName) return;

        map.flyTo(chapters[chapterName]);

        if (document.getElementById(activeChapterName)) {
            document.getElementById(activeChapterName).classList.remove('active');
        }

        if (document.getElementById(chapterName)) {
            document.getElementById(chapterName).classList.add('active');
        }

        activeChapterName = chapterName;
    }

    function isElementOnScreen(id) {
        const element = document.getElementById(id);
        if (!element) return false; // Element does not exist
        const bounds = element.getBoundingClientRect();
        return bounds.top < window.innerHeight && bounds.bottom > 0;
    }

</script>

</body>
</html>